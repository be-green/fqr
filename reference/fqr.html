<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Fast Quantile Regression — fit_fqr • fqr</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Fast Quantile Regression — fit_fqr" />
<meta property="og:description" content="Fast Quantile Regression" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">fqr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Fast Quantile Regression</h1>
    
    <div class="hidden name"><code>fqr.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Fast Quantile Regression</p>
    </div>

    <pre class="usage"><span class='fu'>fit_fqr</span><span class='op'>(</span>
  <span class='va'>X</span>,
  <span class='va'>y</span>,
  <span class='va'>tau</span>,
  se <span class='op'>=</span> <span class='cn'>T</span>,
  init_beta <span class='op'>=</span> <span class='fu'>stats</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>ncol</a></span><span class='op'>(</span><span class='va'>X</span><span class='op'>)</span><span class='op'>)</span>,
  smoothing_window <span class='op'>=</span> <span class='va'>.Machine</span><span class='op'>$</span><span class='va'>double.eps</span>,
  maxiter <span class='op'>=</span> <span class='fl'>10000</span>,
  beta_tol <span class='op'>=</span> <span class='fl'>1e-16</span>,
  check_tol <span class='op'>=</span> <span class='fl'>1e-15</span> <span class='op'>*</span> <span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>nrow</a></span><span class='op'>(</span><span class='va'>X</span><span class='op'>)</span>,
  intercept <span class='op'>=</span> <span class='fl'>1</span>,
  nsubsamples <span class='op'>=</span> <span class='fl'>1000</span>,
  nwarmup_samples <span class='op'>=</span> <span class='fl'>1000</span>,
  warm_start <span class='op'>=</span> <span class='fl'>1</span>
<span class='op'>)</span>

<span class='fu'>fqr</span><span class='op'>(</span>
  <span class='va'>formula</span>,
  <span class='va'>data</span>,
  tau <span class='op'>=</span> <span class='fl'>0.5</span>,
  se <span class='op'>=</span> <span class='cn'>T</span>,
  smoothing_window <span class='op'>=</span> <span class='va'>.Machine</span><span class='op'>$</span><span class='va'>double.eps</span>,
  maxiter <span class='op'>=</span> <span class='fl'>10000</span>,
  beta_tol <span class='op'>=</span> <span class='fl'>1e-16</span>,
  check_tol <span class='op'>=</span> <span class='fl'>1e-15</span> <span class='op'>*</span> <span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>nrow</a></span><span class='op'>(</span><span class='va'>data</span><span class='op'>)</span>,
  nwarmup_samples <span class='op'>=</span> <span class='fl'>1000</span>,
  warm_start <span class='op'>=</span> <span class='fl'>1</span>,
  nsubsamples <span class='op'>=</span> <span class='fl'>1000</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>X</th>
      <td><p>design matrix</p></td>
    </tr>
    <tr>
      <th>y</th>
      <td><p>outcome variable</p></td>
    </tr>
    <tr>
      <th>tau</th>
      <td><p>vector of target quantile(s)</p></td>
    </tr>
    <tr>
      <th>se</th>
      <td><p>whether to calculate standard errors</p></td>
    </tr>
    <tr>
      <th>init_beta</th>
      <td><p>initial betas for gradient descent
(optional, default is random normal initial values)</p></td>
    </tr>
    <tr>
      <th>smoothing_window</th>
      <td><p>neighborhood around 0 to smooth with
tilted least-squares loss function</p></td>
    </tr>
    <tr>
      <th>maxiter</th>
      <td><p>maximum number of allowed iterations for gradient descent</p></td>
    </tr>
    <tr>
      <th>beta_tol</th>
      <td><p>stopping criterion based on largest value of the
gradient</p></td>
    </tr>
    <tr>
      <th>check_tol</th>
      <td><p>stopping criterion based on the change in the
value of the check function between iterations</p></td>
    </tr>
    <tr>
      <th>intercept</th>
      <td><p>what column the intercept is, defaults to 1, 0 to indicate
no intercept</p></td>
    </tr>
    <tr>
      <th>nsubsamples</th>
      <td><p>number of subsamples to use when calculating standard errors</p></td>
    </tr>
    <tr>
      <th>nwarmup_samples</th>
      <td><p>number of samples to use for warmup regression</p></td>
    </tr>
    <tr>
      <th>warm_start</th>
      <td><p>whether to run initial warmup regression or just
default inits for full data gradient descent</p></td>
    </tr>
    <tr>
      <th>formula</th>
      <td><p>Regression formula</p></td>
    </tr>
    <tr>
      <th>data</th>
      <td><p>data to use when fitting regression</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>This package performs quantile regression by approximating the check loss
function with a least-squares loss function in a small neighbor around 0.
Since the only point where the check function is not differentiable is at 0,
this allows for first-order gradient descent methods to work.</p>
<p>This package uses "accelerated" gradient descent, which moves the future guess
at the coefficients not only by a step size * the gradient, but also based
on the prior momentum of the changes in the coefficient which leads to
faster convergence. Gradient-based methods work at scale (both in terms of
observations and dimension), and are much faster than the interior point
algorithms in the quantreg package for large problems. Still, they are
sometimes less exact for small problems.</p>
<p>The algorithm employs two early stopping rules: the `check_tol` argument
stops based on the scaled change in the check function loss. The `beta_tol`
argument stops based on the largest value of the gradient vector.</p>
<p>Before using the full dataset, the optimizer "warms up" on a random subset
of the dataset. nwarmup_samples controls the size of that. `warm_start` is
an integer which controls whether that happens at all
(it is _strongly_ recommended).</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'>
<span class='va'>fit</span> <span class='op'>&lt;-</span> <span class='fu'>fqr</span><span class='op'>(</span><span class='va'>area</span> <span class='op'>~</span> <span class='va'>peri</span>, data <span class='op'>=</span> <span class='va'>rock</span>, tau <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0.25</span>, <span class='fl'>0.5</span>, <span class='fl'>0.75</span><span class='op'>)</span><span class='op'>)</span>

<span class='co'># print coefficients &amp; SEs</span>
<span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span><span class='op'>(</span><span class='va'>fit</span><span class='op'>)</span>
</div><div class='output co'>#&gt; Tau:  0.25 
#&gt;              Coefficient           SE
#&gt; (Intercept) 5.213727e+03 499.87076412
#&gt; peri        4.156585e-02   0.01308446
#&gt; Tau:  0.5 
#&gt;              Coefficient           SE
#&gt; (Intercept) 7.349530e+03 4.085500e+02
#&gt; peri        4.909627e-02 6.188583e-03
#&gt; Tau:  0.75 
#&gt;              Coefficient           SE
#&gt; (Intercept) 8.738315e+03 3.911618e+02
#&gt; peri        4.080978e-02 5.178668e-03</div><div class='input'>
<span class='co'># grab coefficient vector</span>
<span class='fu'><a href='https://rdrr.io/r/stats/coef.html'>coef</a></span><span class='op'>(</span><span class='va'>fit</span><span class='op'>)</span>
</div><div class='output co'>#&gt;              [,1]         [,2]         [,3]
#&gt; [1,] 5.213727e+03 7.349530e+03 8.738315e+03
#&gt; [2,] 4.156585e-02 4.909627e-02 4.080978e-02</div><div class='input'>
<span class='co'># predict values</span>
<span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span><span class='op'>(</span><span class='va'>fit</span><span class='op'>)</span>
</div><div class='output co'>#&gt;        [,1]     [,2]     [,3]
#&gt; 1  5329.775 7486.601 8852.252
#&gt; 2  5375.526 7540.642 8897.171
#&gt; 3  5377.108 7542.510 8898.724
#&gt; 4  5374.559 7539.499 8896.221
#&gt; 5  5377.852 7543.388 8899.454
#&gt; 6  5380.413 7546.413 8901.968
#&gt; 7  5394.362 7562.890 8915.664
#&gt; 8  5394.320 7562.841 8915.623
#&gt; 9  5366.774 7530.304 8888.578
#&gt; 10 5342.525 7501.662 8864.770
#&gt; 11 5399.944 7569.483 8921.145
#&gt; 12 5379.419 7545.239 8900.992
#&gt; 13 5381.509 7547.709 8903.045
#&gt; 14 5359.958 7522.252 8881.885
#&gt; 15 5379.964 7545.884 8901.528
#&gt; 16 5364.573 7527.703 8886.416
#&gt; 17 5405.290 7575.798 8926.393
#&gt; 18 5412.729 7584.584 8933.697
#&gt; 19 5415.913 7588.345 8936.823
#&gt; 20 5399.918 7569.452 8921.119
#&gt; 21 5356.246 7517.868 8878.241
#&gt; 22 5394.669 7563.253 8915.966
#&gt; 23 5408.989 7580.167 8930.025
#&gt; 24 5359.974 7522.272 8881.902
#&gt; 25 5295.919 7446.612 8819.012
#&gt; 26 5271.061 7417.251 8794.606
#&gt; 27 5293.377 7443.610 8816.516
#&gt; 28 5279.627 7427.368 8803.015
#&gt; 29 5290.674 7440.417 8813.862
#&gt; 30 5265.255 7410.392 8788.905
#&gt; 31 5285.559 7434.375 8808.840
#&gt; 32 5274.457 7421.262 8797.940
#&gt; 33 5273.032 7419.578 8796.541
#&gt; 34 5254.894 7398.154 8778.732
#&gt; 35 5269.873 7415.847 8793.439
#&gt; 36 5274.457 7421.262 8797.940
#&gt; 37 5270.951 7417.120 8794.498
#&gt; 38 5233.526 7372.915 8757.753
#&gt; 39 5263.168 7407.928 8786.856
#&gt; 40 5282.101 7430.291 8805.445
#&gt; 41 5252.863 7395.756 8776.739
#&gt; 42 5226.556 7364.683 8750.910
#&gt; 43 5261.349 7405.779 8785.070
#&gt; 44 5308.518 7461.493 8831.381
#&gt; 45 5262.530 7407.174 8786.230
#&gt; 46 5238.576 7378.880 8762.711
#&gt; 47 5274.242 7421.008 8797.729
#&gt; 48 5275.477 7422.466 8798.941</div><div class='input'>
<span class='co'># predict values with new data</span>
<span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span><span class='op'>(</span><span class='va'>fit</span>, newdata <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span><span class='op'>(</span><span class='va'>rock</span><span class='op'>)</span><span class='op'>)</span>
</div><div class='output co'>#&gt;       [,1]     [,2]     [,3]
#&gt; 1 5329.775 7486.601 8852.252
#&gt; 2 5375.526 7540.642 8897.171
#&gt; 3 5377.108 7542.510 8898.724
#&gt; 4 5374.559 7539.499 8896.221
#&gt; 5 5377.852 7543.388 8899.454
#&gt; 6 5380.413 7546.413 8901.968</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Brice Green.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


