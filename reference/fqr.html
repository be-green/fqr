<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Fast Quantile Regression — fit_fqr • fqr</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Fast Quantile Regression — fit_fqr" />
<meta property="og:description" content="Fast Quantile Regression" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">fqr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Fast Quantile Regression</h1>
    
    <div class="hidden name"><code>fqr.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Fast Quantile Regression</p>
    </div>

    <pre class="usage"><span class='fu'>fit_fqr</span><span class='op'>(</span>
  <span class='va'>X</span>,
  <span class='va'>y</span>,
  <span class='va'>tau</span>,
  se <span class='op'>=</span> <span class='cn'>T</span>,
  init_beta <span class='op'>=</span> <span class='fu'>stats</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>ncol</a></span><span class='op'>(</span><span class='va'>X</span><span class='op'>)</span><span class='op'>)</span>,
  smoothing_window <span class='op'>=</span> <span class='va'>.Machine</span><span class='op'>$</span><span class='va'>double.eps</span>,
  maxiter <span class='op'>=</span> <span class='fl'>10000</span>,
  beta_tol <span class='op'>=</span> <span class='fl'>1e-16</span>,
  check_tol <span class='op'>=</span> <span class='fl'>1e-15</span> <span class='op'>*</span> <span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>nrow</a></span><span class='op'>(</span><span class='va'>X</span><span class='op'>)</span>,
  intercept <span class='op'>=</span> <span class='fl'>1</span>,
  nsubsamples <span class='op'>=</span> <span class='fl'>1000</span>,
  nwarmup_samples <span class='op'>=</span> <span class='fl'>1000</span>,
  warm_start <span class='op'>=</span> <span class='fl'>1</span>
<span class='op'>)</span>

<span class='fu'>fqr</span><span class='op'>(</span>
  <span class='va'>formula</span>,
  <span class='va'>data</span>,
  tau <span class='op'>=</span> <span class='fl'>0.5</span>,
  se <span class='op'>=</span> <span class='cn'>T</span>,
  smoothing_window <span class='op'>=</span> <span class='va'>.Machine</span><span class='op'>$</span><span class='va'>double.eps</span>,
  maxiter <span class='op'>=</span> <span class='fl'>10000</span>,
  beta_tol <span class='op'>=</span> <span class='fl'>1e-16</span>,
  check_tol <span class='op'>=</span> <span class='fl'>1e-15</span> <span class='op'>*</span> <span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>nrow</a></span><span class='op'>(</span><span class='va'>data</span><span class='op'>)</span>,
  nwarmup_samples <span class='op'>=</span> <span class='fl'>1000</span>,
  warm_start <span class='op'>=</span> <span class='fl'>1</span>,
  nsubsamples <span class='op'>=</span> <span class='fl'>1000</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>X</th>
      <td><p>design matrix</p></td>
    </tr>
    <tr>
      <th>y</th>
      <td><p>outcome variable</p></td>
    </tr>
    <tr>
      <th>tau</th>
      <td><p>vector of target quantile(s)</p></td>
    </tr>
    <tr>
      <th>se</th>
      <td><p>whether to calculate standard errors</p></td>
    </tr>
    <tr>
      <th>init_beta</th>
      <td><p>initial betas for gradient descent
(optional, default is random normal initial values)</p></td>
    </tr>
    <tr>
      <th>smoothing_window</th>
      <td><p>neighborhood around 0 to smooth with
tilted least-squares loss function</p></td>
    </tr>
    <tr>
      <th>maxiter</th>
      <td><p>maximum number of allowed iterations for gradient descent</p></td>
    </tr>
    <tr>
      <th>beta_tol</th>
      <td><p>stopping criterion based on largest value of the
gradient</p></td>
    </tr>
    <tr>
      <th>check_tol</th>
      <td><p>stopping criterion based on the change in the
value of the check function between iterations</p></td>
    </tr>
    <tr>
      <th>intercept</th>
      <td><p>what column the intercept is, defaults to 1, 0 to indicate
no intercept</p></td>
    </tr>
    <tr>
      <th>nsubsamples</th>
      <td><p>number of subsamples to use when calculating standard errors</p></td>
    </tr>
    <tr>
      <th>nwarmup_samples</th>
      <td><p>number of samples to use for warmup regression</p></td>
    </tr>
    <tr>
      <th>warm_start</th>
      <td><p>whether to run initial warmup regression or just
default inits for full data gradient descent</p></td>
    </tr>
    <tr>
      <th>formula</th>
      <td><p>Regression formula</p></td>
    </tr>
    <tr>
      <th>data</th>
      <td><p>data to use when fitting regression</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>This package performs quantile regression by approximating the check loss
function with a least-squares loss function in a small neighbor around 0.
Since the only point where the check function is not differentiable is at 0,
this allows for first-order gradient descent methods to work.</p>
<p>This package uses "accelerated" gradient descent, which moves the future guess
at the coefficients not only by a step size * the gradient, but also based
on the prior momentum of the changes in the coefficient which leads to
faster convergence. Gradient-based methods work at scale (both in terms of
observations and dimension), and are much faster than the interior point
algorithms in the quantreg package for large problems. Still, they are
sometimes less exact for small problems.</p>
<p>The algorithm employs two early stopping rules: the `check_tol` argument
stops based on the scaled change in the check function loss. The `beta_tol`
argument stops based on the largest value of the gradient vector.</p>
<p>Before using the full dataset, the optimizer "warms up" on a random subset
of the dataset. nwarmup_samples controls the size of that. `warm_start` is
an integer which controls whether that happens at all
(it is _strongly_ recommended).</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'>
<span class='va'>fit</span> <span class='op'>&lt;-</span> <span class='fu'>fqr</span><span class='op'>(</span><span class='va'>area</span> <span class='op'>~</span> <span class='va'>peri</span>, data <span class='op'>=</span> <span class='va'>rock</span>, tau <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0.25</span>, <span class='fl'>0.5</span>, <span class='fl'>0.75</span><span class='op'>)</span><span class='op'>)</span>

<span class='co'># print coefficients &amp; SEs</span>
<span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span><span class='op'>(</span><span class='va'>fit</span><span class='op'>)</span>
</div><div class='output co'>#&gt; Tau:  0.25 
#&gt;              Coefficient           SE
#&gt; (Intercept) 5.213727e+03 498.40343227
#&gt; peri        4.156585e-02   0.01486405
#&gt; Tau:  0.5 
#&gt;              Coefficient           SE
#&gt; (Intercept) 7.420291e+03 4.085429e+02
#&gt; peri        2.489165e-02 6.189918e-03
#&gt; Tau:  0.75 
#&gt;              Coefficient           SE
#&gt; (Intercept) 8.824772e+03 3.911653e+02
#&gt; peri        1.668214e-02 5.178325e-03</div><div class='input'>
<span class='co'># grab coefficient vector</span>
<span class='fu'><a href='https://rdrr.io/r/stats/coef.html'>coef</a></span><span class='op'>(</span><span class='va'>fit</span><span class='op'>)</span>
</div><div class='output co'>#&gt;              [,1]         [,2]         [,3]
#&gt; [1,] 5.213727e+03 7.420291e+03 8.824772e+03
#&gt; [2,] 4.156585e-02 2.489165e-02 1.668214e-02</div><div class='input'>
<span class='co'># predict values</span>
<span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span><span class='op'>(</span><span class='va'>fit</span><span class='op'>)</span>
</div><div class='output co'>#&gt;        [,1]     [,2]     [,3]
#&gt; 1  5329.775 7489.786 8871.346
#&gt; 2  5375.526 7517.184 8889.708
#&gt; 3  5377.108 7518.131 8890.343
#&gt; 4  5374.559 7516.604 8889.320
#&gt; 5  5377.852 7518.576 8890.642
#&gt; 6  5380.413 7520.110 8891.669
#&gt; 7  5394.362 7528.463 8897.268
#&gt; 8  5394.320 7528.439 8897.251
#&gt; 9  5366.774 7511.943 8886.196
#&gt; 10 5342.525 7497.421 8876.464
#&gt; 11 5399.944 7531.806 8899.508
#&gt; 12 5379.419 7519.515 8891.271
#&gt; 13 5381.509 7520.767 8892.110
#&gt; 14 5359.958 7507.860 8883.460
#&gt; 15 5379.964 7519.841 8891.490
#&gt; 16 5364.573 7510.624 8885.312
#&gt; 17 5405.290 7535.008 8901.654
#&gt; 18 5412.729 7539.462 8904.639
#&gt; 19 5415.913 7541.369 8905.917
#&gt; 20 5399.918 7531.790 8899.498
#&gt; 21 5356.246 7505.638 8881.970
#&gt; 22 5394.669 7528.647 8897.391
#&gt; 23 5408.989 7537.223 8903.138
#&gt; 24 5359.974 7507.870 8883.467
#&gt; 25 5295.919 7469.511 8857.759
#&gt; 26 5271.061 7454.625 8847.782
#&gt; 27 5293.377 7467.989 8856.739
#&gt; 28 5279.627 7459.754 8851.220
#&gt; 29 5290.674 7466.370 8855.654
#&gt; 30 5265.255 7451.148 8845.452
#&gt; 31 5285.559 7463.307 8853.601
#&gt; 32 5274.457 7456.659 8849.145
#&gt; 33 5273.032 7455.805 8848.573
#&gt; 34 5254.894 7444.943 8841.293
#&gt; 35 5269.873 7453.913 8847.305
#&gt; 36 5274.457 7456.659 8849.145
#&gt; 37 5270.951 7454.559 8847.738
#&gt; 38 5233.526 7432.147 8832.718
#&gt; 39 5263.168 7449.898 8844.614
#&gt; 40 5282.101 7461.236 8852.213
#&gt; 41 5252.863 7443.727 8840.479
#&gt; 42 5226.556 7427.973 8829.920
#&gt; 43 5261.349 7448.809 8843.884
#&gt; 44 5308.518 7477.056 8862.815
#&gt; 45 5262.530 7449.516 8844.358
#&gt; 46 5238.576 7435.171 8834.744
#&gt; 47 5274.242 7456.530 8849.059
#&gt; 48 5275.477 7457.269 8849.554</div><div class='input'>
<span class='co'># predict values with new data</span>
<span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span><span class='op'>(</span><span class='va'>fit</span>, newdata <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span><span class='op'>(</span><span class='va'>rock</span><span class='op'>)</span><span class='op'>)</span>
</div><div class='output co'>#&gt;       [,1]     [,2]     [,3]
#&gt; 1 5329.775 7489.786 8871.346
#&gt; 2 5375.526 7517.184 8889.708
#&gt; 3 5377.108 7518.131 8890.343
#&gt; 4 5374.559 7516.604 8889.320
#&gt; 5 5377.852 7518.576 8890.642
#&gt; 6 5380.413 7520.110 8891.669</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Brice Green.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


