<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Fast Quantile Regression — fit_fqr • fqr</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Fast Quantile Regression — fit_fqr" />
<meta property="og:description" content="Fast Quantile Regression" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">fqr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Fast Quantile Regression</h1>
    
    <div class="hidden name"><code>fqr.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Fast Quantile Regression</p>
    </div>

    <pre class="usage"><span class='fu'>fit_fqr</span><span class='op'>(</span>
  <span class='va'>X</span>,
  <span class='va'>y</span>,
  <span class='va'>tau</span>,
  se <span class='op'>=</span> <span class='cn'>T</span>,
  init_beta <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>ncol</a></span><span class='op'>(</span><span class='va'>X</span><span class='op'>)</span><span class='op'>)</span>,
  smoothing_window <span class='op'>=</span> <span class='va'>.Machine</span><span class='op'>$</span><span class='va'>double.eps</span>,
  maxiter <span class='op'>=</span> <span class='fl'>10000</span>,
  beta_tol <span class='op'>=</span> <span class='fl'>1e-16</span>,
  check_tol <span class='op'>=</span> <span class='fl'>1e-15</span> <span class='op'>*</span> <span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>nrow</a></span><span class='op'>(</span><span class='va'>X</span><span class='op'>)</span>,
  intercept <span class='op'>=</span> <span class='fl'>1</span>,
  nsubsamples <span class='op'>=</span> <span class='fl'>1000</span>,
  nwarmup_samples <span class='op'>=</span> <span class='fl'>1000</span>,
  warm_start <span class='op'>=</span> <span class='fl'>1</span>
<span class='op'>)</span>

<span class='fu'>fqr</span><span class='op'>(</span>
  <span class='va'>formula</span>,
  <span class='va'>data</span>,
  tau <span class='op'>=</span> <span class='fl'>0.5</span>,
  se <span class='op'>=</span> <span class='cn'>T</span>,
  smoothing_window <span class='op'>=</span> <span class='va'>.Machine</span><span class='op'>$</span><span class='va'>double.eps</span>,
  maxiter <span class='op'>=</span> <span class='fl'>10000</span>,
  beta_tol <span class='op'>=</span> <span class='fl'>1e-16</span>,
  check_tol <span class='op'>=</span> <span class='fl'>1e-15</span> <span class='op'>*</span> <span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>nrow</a></span><span class='op'>(</span><span class='va'>data</span><span class='op'>)</span>,
  nwarmup_samples <span class='op'>=</span> <span class='fl'>1000</span>,
  warm_start <span class='op'>=</span> <span class='fl'>1</span>,
  nsubsamples <span class='op'>=</span> <span class='fl'>1000</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>X</th>
      <td><p>design matrix</p></td>
    </tr>
    <tr>
      <th>y</th>
      <td><p>outcome variable</p></td>
    </tr>
    <tr>
      <th>tau</th>
      <td><p>vector of target quantile(s)</p></td>
    </tr>
    <tr>
      <th>se</th>
      <td><p>whether to calculate standard errors</p></td>
    </tr>
    <tr>
      <th>init_beta</th>
      <td><p>initial betas for gradient descent
(optional, default is random normal initial values)</p></td>
    </tr>
    <tr>
      <th>smoothing_window</th>
      <td><p>neighborhood around 0 to smooth with
tilted least-squares loss function</p></td>
    </tr>
    <tr>
      <th>maxiter</th>
      <td><p>maximum number of allowed iterations for gradient descent</p></td>
    </tr>
    <tr>
      <th>beta_tol</th>
      <td><p>stopping criterion based on largest value of the
gradient</p></td>
    </tr>
    <tr>
      <th>check_tol</th>
      <td><p>stopping criterion based on the change in the
value of the check function between iterations</p></td>
    </tr>
    <tr>
      <th>intercept</th>
      <td><p>what column the intercept is, defaults to 1, 0 to indicate
no intercept</p></td>
    </tr>
    <tr>
      <th>nsubsamples</th>
      <td><p>number of subsamples to use when calculating standard errors</p></td>
    </tr>
    <tr>
      <th>nwarmup_samples</th>
      <td><p>number of samples to use for warmup regression</p></td>
    </tr>
    <tr>
      <th>warm_start</th>
      <td><p>whether to run initial warmup regression or just
default inits for full data gradient descent</p></td>
    </tr>
    <tr>
      <th>formula</th>
      <td><p>Regression formula</p></td>
    </tr>
    <tr>
      <th>data</th>
      <td><p>data to use when fitting regression</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>This package performs quantile regression by approximating the check loss
function with a least-squares loss function in a small neighbor around 0.
Since the only point where the check function is not differentiable is at 0,
this allows for first-order gradient descent methods to work.</p>
<p>This package uses "accelerated" gradient descent, which moves the future guess
at the coefficients not only by a step size * the gradient, but also based
on the prior momentum of the changes in the coefficient which leads to
faster convergence. Gradient-based methods work at scale (both in terms of
observations and dimension), and are much faster than the interior point
algorithms in the quantreg package for large problems. Still, they are
sometimes less exact for small problems.</p>
<p>The algorithm employs two early stopping rules: the `check_tol` argument
stops based on the scaled change in the check function loss. The `beta_tol`
argument stops based on the largest value of the gradient vector.</p>
<p>Before using the full dataset, the optimizer "warms up" on a random subset
of the dataset. nwarmup_samples controls the size of that. `warm_start` is
an integer which controls whether that happens at all
(it is _strongly_ recommended).</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'>
<span class='va'>fit</span> <span class='op'>&lt;-</span> <span class='fu'>fqr</span><span class='op'>(</span><span class='va'>area</span> <span class='op'>~</span> <span class='va'>peri</span>, data <span class='op'>=</span> <span class='va'>rock</span>, tau <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0.25</span>, <span class='fl'>0.5</span>, <span class='fl'>0.75</span><span class='op'>)</span><span class='op'>)</span>
</div><div class='output co'>#&gt; <span class='error'>Error in ss_mat[i, ] &lt;- fit_approx_quantile_model(X[ss_rows, ], y[ss_rows],     X_sub, y_sub, tau[t], init_beta = model_fits[[t]]$coefficients,     mu = smoothing_window, maxiter, beta_tol, check_tol, intercept,     nwarmup_samples, warm_start)$coefficients: number of items to replace is not a multiple of replacement length</span></div><div class='input'>
<span class='co'># print coefficients &amp; SEs</span>
<span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span><span class='op'>(</span><span class='va'>fit</span><span class='op'>)</span>
</div><div class='output co'>#&gt; <span class='error'>Error in print(fit): object 'fit' not found</span></div><div class='input'>
<span class='co'># grab coefficient vector</span>
<span class='fu'><a href='https://rdrr.io/r/stats/coef.html'>coef</a></span><span class='op'>(</span><span class='va'>fit</span><span class='op'>)</span>
</div><div class='output co'>#&gt; <span class='error'>Error in coef(fit): object 'fit' not found</span></div><div class='input'>
<span class='co'># predict values</span>
<span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span><span class='op'>(</span><span class='va'>fit</span><span class='op'>)</span>
</div><div class='output co'>#&gt; <span class='error'>Error in predict(fit): object 'fit' not found</span></div><div class='input'>
<span class='co'># predict values with new data</span>
<span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span><span class='op'>(</span><span class='va'>fit</span>, newdata <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span><span class='op'>(</span><span class='va'>rock</span><span class='op'>)</span><span class='op'>)</span>
</div><div class='output co'>#&gt; <span class='error'>Error in predict(fit, newdata = head(rock)): object 'fit' not found</span></div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Brice Green.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


